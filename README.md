# jit-sbom

Clone GitHub repo(s), discover manifest files (e.g. `package.json`, `requirements.txt`, `go.mod`, `Cargo.toml`), extract dependencies, resolve each package’s license via public registries, and write JSON (and optionally CSV) with licenses as keys and package lists as values.

## Setup

- Python 3.9+
- Install deps: `pip install -r requirements.txt`

## Commands and defaults

| Option | Default | Description |
|--------|---------|-------------|
| `repo` | *(none)* | Single repo: `owner/repo` or full URL. Omit if using `--repos-file` or `--repos`. |
| `--repos-file`, `-f` | *(none)* | JSON file with array of repo strings, e.g. `["owner/repo", ...]`. |
| `--repos` | *(none)* | Comma-separated repos: `repo1,repo2,...`. |
| `--output-dir`, `-o` | `./results` | Directory for `licenses_<repo_slug>.json` (and `.csv` if `--csv`). |
| `--csv` | off | Also write `licenses_<repo_slug>.csv` (default: JSON only). |
| `--summary` | off | After processing, combine all result files into a single `licenses_summary.json`. |
| `--summary-only` | off | Only build `licenses_summary.json` from existing files in `--output-dir`; do not process repos. |

You must provide **one of**: positional `repo`, `--repos-file FILE`, or `--repos repo1,repo2,...` (unless using `--summary-only`).

## Examples

```bash
# Single repo (output: ./results/licenses_owner-repo.json)
python sbom_licenses.py owner/repo

# Single repo, also write CSV, custom output dir
python sbom_licenses.py owner/repo --csv -o ./out

# Multiple repos from a JSON file
python sbom_licenses.py -f repos.json

# Multiple repos from the command line
python sbom_licenses.py --repos owner/repo1,owner/repo2

# After processing multiple repos, write a combined summary
python sbom_licenses.py -f repos.json --summary

# Build summary from existing result files only (no cloning)
python sbom_licenses.py --summary-only -o ./results
```

Cloned repos are temporary and removed after each run. Progress and errors go to stderr.

## Summary file (`licenses_summary.json`)

The summary is **opt-in**: it is **not** generated by default. When you use `--summary` (after a run) or `--summary-only` (standalone), the script writes `licenses_summary.json` in the output directory. It **does not remove** any repo-specific `licenses_<repo_slug>.json` files. The summary hierarchy is:

- **License** → **package** → list of **repos** where that package was found under that license.

License keys are normalized (e.g. "Apache License 2.0" and "Apache-2.0" merge into one). Each package lists the repo slugs that reported it with that license.
